---
title: "simulation"
author: "He Junhui"
date: "`r Sys.Date()`"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

+ knn

```{r}
X <- matrix(rnorm(1e6 * 100), 1e6, 100)
dim(X)
b <- rnorm(100)
y <- drop(X %*% b) + rnorm(1e6)
```

```{r}
system.time(b <- solve(crossprod(X), crossprod(X, y)))
```

```{r}
system.time(rowSums(X))
```
```{r}
X <- matrix(rnorm(1e4 * 100), 1e4, 100)
U <- subsample(X, 500, "random")
```

```{r}
system.time(KNN(X,U,3))
```
```{r}
system.time(KNN(X,U,3))
```

```{r}
system.time(KNN(X,U,3))
```

```{r}
a = rnorm(1e8)
system.time(order(a))
```
```{r}
system.time(which_minn(a,3))
```

```{r}
Z <- matrix(rnorm(1e5 * 200), 1e5, 200)
```

```{r}
S <- rowSums(Z)
```

```{r}
system.time(t(S-t(Z)))
```


+ parallel
```{r}
q = 2
r = 3
Z_list=lapply(c(1:nrow(Z)), function(i) {return(Z[i,])})
system.time(lapply(Z_list, which_minn, r=r))
```

```{r}
cores = detectCores() - 1
cl = makeCluster(cores)
system.time(parLapply(cl, Z_list, which_minn, r=r))
stopCluster(cl)
```




